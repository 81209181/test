<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.hkt.btu.sd.core.dao.mapper.SdTicketMasMapper" >
    <resultMap id="TicketMasEntity" type="com.hkt.btu.sd.core.dao.entity.SdTicketMasEntity" >
        <result column="TICKET_MAS_ID" property="ticketMasId" />
        <result column="CUST_CODE" property="custCode" />
        <result column="TICKET_TYPE" property="ticketType" />
        <result column="STATUS" property="status" />

        <result column="CREATEDATE" property="createdate" />
        <result column="CREATEBY" property="createby" />
        <result column="MODIFYDATE" property="modifydate" />
        <result column="MODIFYBY" property="modifyby" />
    </resultMap>

    <insert id="insertQueryTicket" parameterType="com.hkt.btu.sd.core.dao.entity.SdTicketMasEntity">
        <selectKey keyProperty="ticketMasId" order="BEFORE" resultType="Integer">
            select SEQ_TICKET_MAS_ID.NEXTVAL from dual
        </selectKey>
        insert into TICKET_MAS (TICKET_MAS_ID,CUST_CODE,TICKET_TYPE,STATUS,CREATEBY,MODIFYBY)
        values(#{ticketMasId},#{custCode},'QUERY','O',#{createby},#{createby})
    </insert>

    <select id="findTicketById" resultMap="TicketMasEntity">
        select * from TICKET_MAS where TICKET_MAS_ID = #{ticketId}
    </select>

    <sql id="searchTicketSql">
        from TICKET_MAS
        where 1=1
        <if test="status != null">
            and status = #{status}
        </if>
        <if test="dateFrom != null">
            and trunc(createdate) &gt;= to_date(#{dateFrom},'yyyy-MM-dd')
        </if>
        <if test="dateTo != null">
            and to_date(#{dateTo},'yyyy-MM-dd') >= trunc(createdate)
        </if>
    </sql>

    <select id="searchTicketList" resultMap="TicketMasEntity">
        select *
        <include refid="searchTicketSql"/>
        order by TICKET_MAS_ID
        OFFSET #{offset} ROWS FETCH NEXT #{pageSize} ROWS ONLY
    </select>

    <select id="searchTicketCount" resultType="Integer">
        select count(1)
        <include refid="searchTicketSql"/>
    </select>

    <select id="getMyTicket" resultMap="TicketMasEntity">
        select * from TICKET_MAS where CREATEBY = #{createBy} order by TICKET_MAS_ID
    </select>
</mapper>
